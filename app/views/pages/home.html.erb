<div class="home-container">
  <div class="home-left-right-container">

    <div class="home-left-container">
      <% if current_user %>
        <h3 class="home-card-title">Welcome <%=current_user.name %> </h3>
      <% else %>
        <h3>Welcome on TORN !</h3>
      <% end %>
    </div>

    <div class="home-right-container">
        <div class="right-section-titles">
          <h3 id="diff-budgets">Tes differents budgets</h3>
          <% if UserBudget.where(user_id: current_user.id).length > 3 %>
            <%= link_to "Create New Budget", "#", class:"create-budget-button-disable", data: { confirm: 'You reached the maximum amount of 4 budgets. Delete a budget before creating a new one !' } %>
          <% else %>
            <%= link_to "Create New Budget", new_budget_path, class:"create-budget-button" %>
          <% end %>

        </div>

        <% if @budgets.length == 0 %>
        <h6> Pas encore de budget !</h6>
        <% else %>
          <ul style="flex-grow: 2; display: flex">
            <div class="home-cards-container">
              <% @budgets.sort_by { |p| p.updated_at }.reverse!.each do |budget| %>
                <% budget_ids = [] %>
                <% budget.users.each do |u|%>
                  <% budget_ids << u.id %>
                <% end %>
                <% if current_user && budget_ids.include?(current_user.id) %>
                    <div class="home-card">
                      <div class="content">
                        <div class="contentBx">
                          <h3 class="home-card-title"><%= budget.name %></h3>
                          <h5><%= budget.debt_status(current_user) %></h5>
                        </div>
                      </div>
                      <ul class="sci">
                        <li>
                          <p>
                            <%= link_to(budget) do %>
                              <div class="hidden-card-title-container">
                                <p class="hidden-card-title" style="font-size: 2.5vw"> <%= budget.name %> </p>
                                <p class="hidden-card-title">with <%= budget.other_participant(current_user)[0].capitalize %></p>
                              </div>
                            <% end %>
                          </p>
                        </li>
                        <li>
                          <p>
                            <div class="hidden-display-flex">
                              <div class="hidden-flex-item">
                                <div>
                                  Total spent
                                </div>
                                <div style="font-size: 30px !important;">
                                  <%=budget.total_cents %>€
                                </div>
                              </div>

                              <div class="hidden-flex-item-2">
                                <div>
                                  Balance
                                </div>
                                <div style="font-size: 15px !important;">
                                  <%= budget.debt_status(current_user) %>
                                </div>
                              </div>
                            </div>
                          </p>
                        </li>
                        <li>
                          <p>
                            <div class="hidden-card-buttons-container">

                              <%=link_to edit_budget_path(budget) do %>
                                <div class="hidden-card-button">
                                  Edit
                                </div>
                              <% end %>

                              <%=link_to budget_path(budget), method: :delete, data: { confirm: 'Are you sûr(e)?' } do %>
                                <div class="hidden-card-button-2">
                                  Delete
                                </div>
                              <% end %>

                            </div>
                          </p>
                        </li>
                      </ul>
                      <div class="anim-background"></div>
                    </div>


                <% else %>
                <% end %>
              <% end %>
            </div>
          </ul>
        <% end %>


    </div>
  </div>
</div>
